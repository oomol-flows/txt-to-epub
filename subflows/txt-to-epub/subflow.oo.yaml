nodes:
  - node_id: txt-to-epub#1
    title: "Txt To Epub #1"
    inputs_from:
      - handle: txt_file
        value: /oomol-driver/oomol-storage/book/伯特兰·罗素：哲学问题.txt
        from_flow:
          - input_handle: txt_file
      - handle: book_title
        value: null
        from_flow:
          []
        from_node:
          - node_id: get_book_info#1
            output_handle: title
      - handle: author
        value: null
        from_flow:
          []
        from_node:
          - node_id: get_book_info#1
            output_handle: author
      - handle: cover_image
        value: null
        from_flow:
          []
        from_node:
          - node_id: +python#1
            output_handle: cover_image
      - handle: epub_dir
        value: /oomol-driver/oomol-storage/book
        from_flow:
          - input_handle: epub_dir
    task: self::txt-to-epub-core
  - node_id: txt-first-800-chars#1
    title: "Extract First 800 Characters #1"
    inputs_from:
      - handle: txt_file
        from_flow:
          - input_handle: txt_file
    task: self::txt-first-800-chars
  - node_id: llm#1
    title: "LLM #1"
    inputs_from:
      - handle: messages
        value: null
      - handle: timeout
        value: 30
      - handle: retry_times
        value: 0
      - handle: retry_sleep
        value: 3.5
      - handle: model
        value:
          model: deepseek-chat
          temperature: 0.5
          top_p: 1
          max_tokens: 8192
      - handle: template
        value:
          - role: user
            content: "任务书籍信息判断，{{book_title}} 和 {{author}} 不为空，就直接使用。为空那么使用一下方式判断：

              {{filename}} 是这本书的文件名。{{first_800_chars}}是一本书的文件前
              800 个字，你需要这个内容中获取书名和作者名字，使用和书本一样的语言。  "
        schema_overrides:
          - schema:
              type: array
      - handle: skills
        value:
          []
      - handle: stream
        value: true
      - handle: first_800_chars
        value: hello!
        from_node:
          - node_id: txt-first-800-chars#1
            output_handle: first_800_chars
      - handle: filename
        from_node:
          - node_id: txt-first-800-chars#1
            output_handle: filename
      - handle: book_title
        value:
        from_flow:
          - input_handle: book_title
      - handle: author
        value:
        from_flow:
          - input_handle: author
    task: llm::llm
    inputs_def:
      - handle: first_800_chars
        json_schema:
          type: string
          ui:widget: text
        value: hello!
      - handle: filename
        description: Name of the input file
        json_schema:
          type: string
        nullable: false
      - handle: book_title
        json_schema:
          type: string
        nullable: true
      - handle: author
        json_schema:
          type: string
        nullable: true
    outputs_def:
      - handle: book_title
        description: write your answer here
        json_schema:
          type: string
      - handle: author
        json_schema:
          type: string
  - node_id: get_book_info#1
    title: "Get Book Info #1"
    inputs_from:
      - handle: title
        from_node:
          - node_id: llm#1
            output_handle: book_title
      - handle: author
        value: null
        from_node:
          - node_id: llm#1
            output_handle: author
    task: get-book-info::get_book_info
  - node_id: url2file#1
    title: "URL to file #1"
    inputs_from:
      - handle: url
        from_node:
          - node_id: get_book_info#1
            output_handle: cover_url
      - handle: saved_folder
        value: null
      - handle: ensure_folder
        value: false
      - handle: file_head
        value: null
      - handle: if_existing
        value: override
      - handle: threads_count
        value: 1
      - handle: headers
        value:
          {}
      - handle: cookies
        value:
          {}
      - handle: window_width
        value: 7
      - handle: failure_ladder
        value:
          - 5
      - handle: min_segment_length
        value: 1048576
      - handle: once_fetch_size
        value: 16384
      - handle: timeout
        value: 30
      - handle: retry_times
        value: 0
      - handle: retry_sleep
        value: 0
    subflow: downloader::url2file
  - node_id: +python#1
    title: "Python #1"
    icon: ":logos:python:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: cover_image
          json_schema:
            type: string
            ui:widget: file
          nullable: true
        - handle: download_cover
          json_schema:
            type: string
            ui:widget: save
          nullable: true
          description: Path of the downloaded file
      outputs_def:
        - handle: cover_image
          json_schema:
            type: string
            ui:widget: file
          nullable: true
      executor:
        name: python
        options:
          entry: scriptlets/+scriptlet#1.py
    inputs_from:
      - handle: download_cover
        from_node:
          - node_id: url2file#1
            output_handle: file
        value:
      - handle: cover_image
        value:
        from_flow:
          - input_handle: cover_image
inputs_def:
  - handle: txt_file
    description: Input txt file
    json_schema:
      type: string
      ui:widget: file
    nullable: false
    executor_name: python
  - handle: epub_dir
    json_schema:
      type: string
      ui:widget: dir
    value: /oomol-driver/oomol-storage/book
    nullable: false
    executor_name: python
  - handle: book_title
    json_schema:
      type: string
    nullable: true
    value:
    executor_name: python
  - handle: author
    json_schema:
      type: string
    nullable: true
    value:
    executor_name: python
  - handle: cover_image
    json_schema:
      type: string
      ui:widget: file
    nullable: true
    value:
    executor_name: python
outputs_def:
  - handle: epub_file
    json_schema:
      type: string
      ui:widget: file
    nullable: false
    description: Output
    executor_name: python
outputs_from:
  - handle: epub_file
    from_node:
      - node_id: txt-to-epub#1
        output_handle: epub_file
title: Txt To Epub
